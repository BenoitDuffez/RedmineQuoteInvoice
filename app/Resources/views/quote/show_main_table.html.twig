<div class="private row">
    <div class="col-xs-12">
        <h3>Comments</h3>
        <p>{{ quote.comments | markdown }}</p>
    </div>
</div>

{% set quoteTotal = 0 %}
{% set quoteHours = 0 %}
{% set optionId = 0 %}
{% set quoteOptionsTotal = {} %}
{% set quoteOptionsHours = {} %}
{% set quoteTitles = {} %}
<table class="table table-bordered">
    <thead>
    <tr>
        <th>Section</th>
        <th>Désignation</th>
        <th class="private">Temps estimé</th>
        <th class="text-right">Total H.T.</th>
    </tr>
    </thead>
    <tbody>
    {% for section in quote.sections %}
        {% set sectionTotal = 0 %}
        {% set sectionHours = 0 %}
        {% for item in section.items %}
            <tr>
                {% if loop.index0 == 0 %}
                    <td class="col-md-2" rowspan="{{ section.items | length }}">
                        {% if section.option %}
                            <strong>OPTION {{ "%d" | format(optionId + 1) }}</strong><br />
                        {% endif %}
                        {{ section.title }}
                    </td>
                {% endif %}
                <td class="col-md-8">
                    <div class="row">
                        <div class="col-md-12">
                            {{ item.description | markdown }}
                            {% set sectionTotal = sectionTotal + item.hours * section.rate %}
                            {% set sectionHours = sectionHours + item.hours %}
                        </div>
                    </div>
                </td>
                <td class="private">{{ "%.2fh" | format(item.hours) }}</td>
                <td class="text-right col-md-2">{{ "%d €" | format(item.hours * section.rate) }}</td>
            </tr>
        {% endfor %}
        {% if section.isOption %}
            {% set quoteOptionsTotal = quoteOptionsTotal | merge({(optionId): sectionTotal}) %}
            {% set quoteOptionsHours = quoteOptionsHours | merge({(optionId): sectionHours}) %}
            {% set quoteTitles = quoteTitles | merge({(optionId): section.title}) %}
            {% set optionId = optionId + 1 %}
        {% else %}
            {% set quoteTotal = quoteTotal + sectionTotal %}
            {% set quoteHours = quoteHours + sectionHours %}
        {% endif %}
        <tr>
            <th class="col-md-10 text-right" colspan="2">Total</th>
            <th class="private">{{ "%.2fh" | format(sectionHours) }}</th>
            <th class="text-right col-md-2">{{ "%d €" | format(sectionTotal) }}</th>
        </tr>
    {% endfor %}
    </tbody>
</table>
